# Runbook: Installing and Configuring Management Server (MGMT VLAN)

## Overview
This runbook details the installation and configuration of a **Management Server** VM on the **MGMT (10.0.11.0/24) Network**.  
The Management Server provides a secure workstation for accessing and administering the **OPNsense firewall** and other core infrastructure services via web GUI or SSH.

---

## Objectives
- Deploy a OS suitable for network management tasks.
- Configure static IP addressing within the MGMT subnet.
- Verify access to the OPNsense web interface (typically at `https://10.0.10.11`).
- Harden the server for administrative use.

---

## Prerequisites
- Hyper V installed and configured with internal network switches.
- OPNsense Firewall VM operational.
- 'MGMT' Internal Network configured in OPNsense (`10.0.10.0/24`, gateway `10.0.10.11`).
- DHCP disabled on MGMT VLAN (use static IP for this server).

---
## Related Runbooks

This Management Server will be built using the same base procedures outlined in the following runbooks:

- [Installing Windows Server](./Installing-Windows-Server-in-HyperV.md)


---
>  **Important Notes**
>
> - This server is part of the primary Server VLAN (10.10.10.0/24) used in those runbooks.  
>   It belongs to the **Management VLAN (10.0.20.0/24)** and should be configured with:
>   ```
>   Hostname: MGMT-SERVER
>   IP Address: 10.0.20.2
>   Subnet: 255.255.255.0 (/24)
>   Gateway: 10.0.20.1 (OPNsense MGMT interface)
>   DNS: 10.0.20.1
>   ```
> - The purpose of this VM is **administrative**: it provides secure web GUI access to OPNsense and other infrastructure services.
> - Do **not** join this VM to the domain unless you explicitly want to manage it through Active Directory policies.
> - Ensure its network adapter is attached to the **MGMT internal network** in VirtualBox, *not* the Servers VLAN used previously.
> **- If this server is not on the OPNsense 'LAN' Interface, OPNsense will block traffic by default. This requires a temorary disabling of firewall to access Web GUI and allow access to OPNsense rule before reenabling firewall for permenant access with firewall up. Steps will be shown in seperate runbook.**

---

## Procedure

If you’ve already followed the above runbooks, you can reuse them here:

1. Perform all steps from **Installing Windows Server** for OS setup and initial configuration.  

2. Perform relevant steps from **Configuring Windows Connection** to assign a static IP — adjusting the network details as specified above.

3. Skip any domain join or DNS server setup steps, as this server is a standalone management node.

4. Proceed with the **Validation**  

5. Verify MGMT connection to firewall
  - In MGMT Admin Powershell, ping host interface (10.0.20.1)
  - **Expected Outcome:** sucessful ping
  - In MGMT Admin Powershell, ping external network (8.8.8.8)
  - **Expected Outcome:** sucessful ping

6. **Verify Connection if not on LAN interface** 
 1. At OPNsense console menu, enter shell by pressing '8' and run
 2. Run 'pfctl -d' to temporarily disable firewall
 3. Verify MGMT connection to firewall
  - In MGMT Admin Powershell, ping host interface (10.0.20.1)
  - **Expected Outcome:** sucessful ping
 4. In OPNsense Shell, re enable firwall by running 'pfctl -e'
