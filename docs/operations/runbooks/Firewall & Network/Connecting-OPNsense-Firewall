# Runbook: Connecting OPNsense Firewall

## Overview
This runbook outlines the initial connection of the OPNsense firewall after installation in the Virtual Enterprise Network project.  
It includes setting up interfaces, assigning static IPs, enabling VLANs, configuring DHCP.

---

## Prerequisites
- OPNsense VM installed and booted
- VirtualBox networks created:
  - **WAN adapter:** NAT or Bridged
  - **LAN adapter:** Internal Network (e.g. `SERVERS`)
  - Optional: Additional adapters for DMZ, Management, etc.
- Access to OPNsense web GUI (`https://<LAN_IP>:443`)
- Network plan documented (e.g., `ip-plan.md`)

---

## Procedure

### 1. Verify Network Interfaces

1. Log into OPNsense console by (root).
  -Enter '8' into main terminal

2. Run `ifconfig` to list available adapters.

3. Confirm expected interfaces appear 'eg. em0, em1, em2, em3'

---

### 2. Assign Interfaces

1. From the console menu, select **Option 1 – Assign Interfaces**.

2. Do not configure LAGGS (Link Aggregation Groups) now.
  -'n' and Return

3. Configure VLANS
  -'y' and Return

4.Assign:
   - Skip Enter Parent Interface 
     - Press Return
   - **WAN:** Enter WAN Interface Name
     - First adapter (e.g., `em0` for WAN)
   - **LAN:** Enter LAN Interface Name
     - Second adapter (e.g., `em1`for SERVERS)
   - Optional: Enter optional interface 1 name
     - Additional VLANs (e.g., `em2` for USERS)
   - Optional: Enter optional interface 2 name
     - Additional VLANs (e.g., `em3` for DMZ)
     - Press Return to end assigning

3. Confirm assignments are correct, then reboot if prompted.

---

### 3. Configure IP's

1. Set Interface 0 to WAN
  - From the console menu, select **Option 2 – Set Interface IP address**.
  - Choose the **WAN** interface. (eg. em0)
  - When prompted:
   - **Configure ipv4 address WAN interface via DHCP:** **Yes**
   - **Configure ipv6 address WAN interface via DHCP:** **Yes**
   - **Restore Web GUI access Defaults:** **NO**
   - **Switch to HTTPS Access for Web GUI:** **Yes** (for web GUI)
  - After completion, note the WAN IP

2. Set Interface 1 to LAN (eg. INTERNAL)
  - From the console menu, select **Option 2 – Set Interface IP address**.
  - Choose the **LAN** interface. (eg. em1)
  - When prompted:
   - **Configure ipv4 address LAN interface via DHCP:** **No**
   - **Enter the new LAN ipv4 address:** 10.0.10.1
   - **Enter the new LAN ipv4 subnet bit count:** 24
   - **Enter Upsream Gateway:** **no** (empty field)
   - **Configure ipv6 address LAN interface via WAN tracking:** **yes**
   - **Do you want to enable DHCP server on LAN:** **no**
   - **Restore Web GUI access Defaults:** **NO**
  - After completion, note the LAN IP

3.  Set Interface 2 to LAN (eg. MGMT)
  - From the console menu, select **Option 2 – Set Interface IP address**.
  - Choose the **LAN** interface. (eg. em1)
  - When prompted:
   - **Configure ipv4 address LAN interface via DHCP:** **No**
   - **Enter the new LAN ipv4 address:** 10.0.20.1
   - **Enter the new LAN ipv4 subnet bit count:** 24
   - **Enter Upsream Gateway:** **no** (empty field)
   - **Configure ipv6 address LAN interface via WAN tracking:** **yes**
   - **Do you want to enable DHCP server on LAN:** **no**
   - **Restore Web GUI access Defaults:** **NO**
  - After completion, note the OPT1 IP

4.  Set Interface 3 to LAN (eg. DMZ)
  - From the console menu, select **Option 2 – Set Interface IP address**.
  - Choose the **LAN** interface. (eg. em1)
  - When prompted:
   - **Configure ipv4 address LAN interface via DHCP:** **No**
   - **Enter the new LAN ipv4 address:** 10.0.30.1
   - **Enter the new LAN ipv4 subnet bit count:** 24
   - **Enter Upsream Gateway:** **no** (empty field)
   - **Configure ipv6 address LAN interface via WAN tracking:** **yes**
   - **Do you want to enable DHCP server on LAN:** **no**
   - **Restore Web GUI access Defaults:** **NO**
  - After completion, note the OPT2 IP


## Validation

1. From LAN VM, open Powershell as administrator

2. Run:
  - `ping 10.10.10.1` → should succeed.
  - `ping 8.8.8.8` → should succeed (internet access).
  - `ping google.com` → should succeed (DNS resolution).
